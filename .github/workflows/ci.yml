name: CI


on:
push:
branches: [ main, master ]
pull_request:
branches: [ main, master ]


permissions:
contents: read
packages: write # required to publish to GHCR


jobs:
test:
runs-on: ubuntu-latest
strategy:
matrix:
python-version: [3.11, 3.12]
steps:
- uses: actions/checkout@v4
- name: Set up Python
uses: actions/setup-python@v4
with:
python-version: ${{ matrix.python-version }}
- name: Cache pip
uses: actions/cache@v4
with:
path: ~/.cache/pip
key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
- name: Install deps
run: |
python -m pip install --upgrade pip
pip install -r requirements.txt
- name: Run lint (optional)
run: |
pip install flake8
flake8 --max-line-length=120 || true
- name: Run unit tests (fast smoke tests)
run: |
# Example quick checks: ensure save_clients runs and produces artifact
python -c "import sys; import save_clients; print('save_clients import ok')"
python save_clients.py
- name: Upload produced client_datasets.pkl as artifact
if: always()
uses: actions/upload-artifact@v4
with:
name: client_datasets
path: client_datasets.pkl


build-and-push:
needs: test
runs-on: ubuntu-latest
steps:
- uses: actions/checkout@v4
- name: Log in to GitHub Container Registry
uses: docker/login-action@v2
with:
registry: ghcr.io
run: echo "Image pushed to GHCR: ghcr.io/${{ secrets.GHCR_USERNAME }}/federated-ml:latest"